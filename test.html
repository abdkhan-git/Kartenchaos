<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   
</head>
<style>
    body {
        background-color: #000;
        margin: 0;
        overflow: hidden;
    }

    canvas {
        position: absolute;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        -moz-backface-visibility: hidden;
        -ms-backface-visibility: hidden;
    }

    img {
       
        cursor: pointer;
    }

    .TEST2 {
        position: absolute;
        width: 239px;
        height: 335px;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        margin: auto;
    }
</style>
<body style="background-color: brown;">
    

    
    <!-- CLASH 1v1 PAGE -->
<div id="clash-page" >

    <!-- health-bars -->
    
    <div class="barcontainer" >
            
        <div class="bar1">
            <progress value="100" max="100" id="p1-health-bar">Player 1 Health</progress>
            
            <div class="p1-damage-indicator-container"><h1 class="p1-damage-taken hidden">-10</h1></p></div>

        </div>
        
        <div class="bar2">
            <progress value="100" max="100" id="p2-health-bar">Player 2 Health</progress>
        
            <div class="p2-damage-indicator-container"><h1 class="p2-damage-taken hidden">-10</h1></p></div>
        </div>
    </div>
    <div class = "cardcontainer">
    <div class = "card1container" id = "con" >
        <div class = "TEST" id = "con1">
        <img src = "client/cards/10C.svg" class = "card2clash" id = "player1card">
    </div>
    </div>
    <div class="vs-container">
        <p class = "v">V</p>
        <p class="s">S</p>
    </div>
    <div class = "card2container">
        <div class = "TEST2" id = "con2" class = "purple">
            
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="card" face="TH" preserveAspectRatio="none" viewBox="-120 -168 240 336"><defs><symbol id="opp-SHT" viewBox="-600 -600 1200 1200" preserveAspectRatio="xMinYMid"><path d="M0 -300C0 -400 100 -500 200 -500C300 -500 400 -400 400 -250C400 0 0 400 0 500C0 400 -400 0 -400 -250C-400 -400 -300 -500 -200 -500C-100 -500 0 -400 -0 -300Z" fill="red"></path></symbol><symbol id="opp-VHT" viewBox="-500 -500 1000 1000" preserveAspectRatio="xMinYMid"><path d="M-260 430L-260 -430M-50 0L-50 -310A150 150 0 0 1 250 -310L250 310A150 150 0 0 1 -50 310Z" stroke="red" stroke-width="80" stroke-linecap="square" stroke-miterlimit="1.5" fill="none"></path></symbol></defs><rect width="239" height="335" x="-119.5" y="-167.5" rx="12" ry="12" fill="white" stroke="black"></rect><use xlink:href="#opp-VHT" height="32" width="32" x="-114.4" y="-156"></use><use xlink:href="#opp-SHT" height="26.769" width="26.769" x="-111.784" y="-119"></use><use xlink:href="#opp-SHT" height="70" width="70" x="-87.501" y="-135.501"></use><use xlink:href="#opp-SHT" height="70" width="70" x="17.501" y="-135.501"></use><use xlink:href="#opp-SHT" height="70" width="70" x="-87.501" y="-68.5"></use><use xlink:href="#opp-SHT" height="70" width="70" x="17.501" y="-68.5"></use><use xlink:href="#opp-SHT" height="70" width="70" x="-35" y="-102"></use><g transform="rotate(180)"><use xlink:href="#opp-VHT" height="32" width="32" x="-114.4" y="-156"></use><use xlink:href="#opp-SHT" height="26.769" width="26.769" x="-111.784" y="-119"></use><use xlink:href="#opp-SHT" height="70" width="70" x="-87.501" y="-135.501"></use><use xlink:href="#opp-SHT" height="70" width="70" x="17.501" y="-135.501"></use><use xlink:href="#opp-SHT" height="70" width="70" x="-87.501" y="-68.5"></use><use xlink:href="#opp-SHT" height="70" width="70" x="17.501" y="-68.5"></use><use xlink:href="#opp-SHT" height="70" width="70" x="-35" y="-102"></use></g></svg>
            <audio id = "breaksound" src = "Glass Break Sound.mp3"></audio>
        </div>
    </div>
</div>
<button id="shatterButton">Shatter</button>
<div class="p1-card">Player 1
    <button class="p1-attack">ATTACK</button>
</div>
<div class="p2-card">Player 2
    <button class="p2-attack">ATTACK</button>
</div>





        
</div>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/175711/delaunay.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.13.2/TweenMax.min.js"></script>
    <script>
        const TWO_PI = Math.PI * 2.5;
        const imageWidth = 239; // Assuming image width
        const imageHeight = 335; // Assuming image height
        const images = document.querySelectorAll('.TEST2 svg');
        var imageIndex = 0;
        var vertices = [];
        var indices = [];
        var fragments = [];
        var container = document.getElementById('con2');

        document.getElementById('shatterButton').addEventListener('click', function () {
            var shatterSound = document.getElementById('breaksound');
            shatterSound.currentTime = .5;
            
            shatter();
            shatterSound.play();
            //
            
        });

        function shatter() {
            
            var clickPosition = [imageWidth/2, imageHeight/2];
           

            triangulate(clickPosition);
            shatterAnimation(clickPosition);
        }

        function triangulate(clickPosition) {
            var rings = [
                { r: 500, c: 12 },
                { r: 10, c: 12 },
                { r: 700, c: 12 },
                { r: 1200, c: 12 } // very large in case of corner clicks
            ];
            var x, y;
            var centerX = clickPosition[0];
            var centerY = clickPosition[1];

            vertices.push([centerY, centerX]);

            rings.forEach(function (ring) {
                var radius = ring.r;
                var count = ring.c;
                var variance = radius * 0.05;

                for (var i = 0; i < count; i++) {
                    x = Math.cos((i / count) * TWO_PI) * radius + centerY + randomRange(-variance, variance);
                    y = Math.sin((i / count) * TWO_PI) * radius + centerX + randomRange(-variance, variance);
                    vertices.push([x, y]);
                }
            });

            vertices.forEach(function (v) {
                v[0] = clamp(v[0], 0, imageWidth);
                v[1] = clamp(v[1], 0, imageHeight);
            });

            indices = Delaunay.triangulate(vertices);
        }

        function shatterAnimation(clickPosition) {
            var p0, p1, p2, fragment;
            var tl0 = new TimelineMax({ onComplete: shatterCompleteHandler });

            for (var i = 0; i < indices.length; i += 3) {
                p0 = vertices[indices[i + 0]];
                p1 = vertices[indices[i + 1]];
                p2 = vertices[indices[i + 2]];

                fragment = new Fragment(p0, p1, p2);

                var dx = fragment.centroid[0] - clickPosition[1];
                var dy = fragment.centroid[1] - clickPosition[1];
                var d = Math.sqrt(dx * dx + dy * dy);
                var rx = 200 * sign(dy);
                var ry = 100 * -sign(dx);
                var delay = d * 0.004 * randomRange(0.9, 1.1);
                fragment.canvas.style.zIndex = Math.floor(d).toString();

                var tl1 = new TimelineMax();

                tl1.to(fragment.canvas, 1, {
                    z: -500,
                    rotationX: rx,
                    rotationY: ry,
                    ease: Cubic.easeIn
                });
                tl1.to(fragment.canvas, 0.4, { alpha: 0 }, 0.5);

                tl0.insert(tl1, delay);

                fragments.push(fragment);
                container.appendChild(fragment.canvas);
            }

            container.removeChild(images[imageIndex]);
            
        }

        function shatterCompleteHandler() {
            setTimeout(function () {
                fragments.forEach(function (f) {
                    container.removeChild(f.canvas);
                });
                fragments.length = 0;
                vertices.length = 0;
                indices.length = 0;

                placeImage();
            }, 10000);
        }

        function randomRange(min, max) {
            return min + (max - min) * Math.random();
        }

        function clamp(x, min, max) {
            return x < min ? min : (x > max ? max : x);
        }

        function sign(x) {
            return x < 0 ? -1 : 1;
        }

        function Fragment(v0, v1, v2) {
            this.v0 = v0;
            this.v1 = v1;
            this.v2 = v2;

            this.computeBoundingBox();
            this.computeCentroid();
            this.createCanvas();
            this.clip();
        }

        Fragment.prototype = {
            computeBoundingBox: function () {
                var xMin = Math.min(this.v0[0], this.v1[0], this.v2[0]);
                var xMax = Math.max(this.v0[0], this.v1[0], this.v2[0]);
                var yMin = Math.min(this.v0[1], this.v1[1], this.v2[1]);
                var yMax = Math.max(this.v0[1], this.v1[1], this.v2[1]);

                this.box = {
                    x: xMin,
                    y: yMin,
                    w: xMax - xMin,
                    h: yMax - yMin
                };
            },
            computeCentroid: function () {
                var x = (this.v0[0] + this.v1[0] + this.v2[0]) ;
                var y = (this.v0[1] + this.v1[1] + this.v2[1]);

                this.centroid = [x, y];
            },
           createCanvas: function () {
    this.canvas = document.createElement('canvas');
    // Set canvas size to match original SVG image size
    this.canvas.width = imageWidth;
    this.canvas.height = imageHeight;
    this.canvas.style.width = imageWidth + 'px';
    this.canvas.style.height = imageHeight + 'px';
    this.canvas.style.left = this.box.x + 'px';
    this.canvas.style.top = this.box.y + 'px';
    this.ctx = this.canvas.getContext('2d');
},

clip: function () {
    this.ctx.translate(-this.box.x, -this.box.y);
    this.ctx.beginPath();
    this.ctx.moveTo(this.v0[0], this.v0[1]);
    this.ctx.lineTo(this.v1[0], this.v1[1]);
    this.ctx.lineTo(this.v2[0], this.v2[1]);
    this.ctx.closePath();
    this.ctx.clip();
    
    var image = images[imageIndex];
    console.log(image)

    if (image instanceof SVGElement) {
        // Convert SVG to data URL
        var svgString = new XMLSerializer().serializeToString(image);
        var blob = new Blob([svgString], { type: 'image/svg+xml' });
        var url = URL.createObjectURL(blob);

        // Create a new Image object
        var img = new Image();
        img.onload = function() {
            // Draw the image onto the canvas
            this.ctx.imageSmoothingEnabled = false;
      
            this.ctx.drawImage(img, 0, 0, imageWidth, imageHeight); // Specify width and height
            // Clean up by revoking the URL
            URL.revokeObjectURL(url);
        }.bind(this);
        img.src = url;
    } else if (image instanceof HTMLImageElement || 
               image instanceof HTMLCanvasElement || 
               image instanceof HTMLVideoElement || 
               image instanceof OffscreenCanvas || 
               image instanceof ImageBitmap) {
        // Draw other supported image types directly onto the canvas
    
        this.ctx.drawImage(image, 0, 0, imageWidth* window.devicePixelRatio, imageHeight *window.devicePixelRatio); // Specify width and height
    } else {
        // Handle unsupported image types
        console.error(images);
        console.error(image);
        console.error("Unsupported image type:", typeof image);
    }
}
        };
    </script>
</body>
</html>
