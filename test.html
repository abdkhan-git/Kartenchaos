<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   
</head>
<style>
    body {
        background-color: #000;
        margin: 0;
        overflow: hidden;
    }

    canvas {
        position: absolute;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        -moz-backface-visibility: hidden;
        -ms-backface-visibility: hidden;
    }

    img {
       
        cursor: pointer;
    }

    .TEST {
        position: absolute;
        width: 240px;
        height: 366px;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        margin: auto;
    }
</style>
<body style="background-color: brown;">
    

    
    <!-- CLASH 1v1 PAGE -->
<div id="clash-page" >

    <!-- health-bars -->
    
    <div class="barcontainer" >
            
        <div class="bar1">
            <progress value="100" max="100" id="p1-health-bar">Player 1 Health</progress>
            
            <div class="p1-damage-indicator-container"><h1 class="p1-damage-taken hidden">-10</h1></p></div>

        </div>
        
        <div class="bar2">
            <progress value="100" max="100" id="p2-health-bar">Player 2 Health</progress>
        
            <div class="p2-damage-indicator-container"><h1 class="p2-damage-taken hidden">-10</h1></p></div>
        </div>
    </div>
    <div class = "cardcontainer">
    <div class = "card1container" id = "con" >
        <div class = "TEST" id = "con1">
        <img src = "client/cards/10C.svg" class = "card2clash" id = "player1card">
    </div>
    </div>
    <div class="vs-container">
        <p class = "v">V</p>
        <p class="s">S</p>
    </div>
    <div class = "card2container">
    <div class = "TEST2" id = "con2">
        <img src = "client/cards/10C.svg"  class = "card2clash" id = "player2card">
        <audio id = "breaksound" src = "Glass Break Sound.mp3"></audio>
    </div>
    </div>
</div>
<button id="shatterButton">Shatter</button>
<div class="p1-card">Player 1
    <button class="p1-attack">ATTACK</button>
</div>
<div class="p2-card">Player 2
    <button class="p2-attack">ATTACK</button>
</div>





        
</div>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/175711/delaunay.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.13.2/TweenMax.min.js"></script>
    <script>
        const TWO_PI = Math.PI * 2.5;
        const imageWidth = 240; // Assuming image width
        const imageHeight = 366; // Assuming image height
        const images = document.querySelectorAll('.TEST2 img');

        var imageIndex = 0;
        var vertices = [];
        var indices = [];
        var fragments = [];
        var container = document.getElementById('con2');

        document.getElementById('shatterButton').addEventListener('click', function () {
            var shatterSound = document.getElementById('breaksound');
            shatterSound.currentTime = .5;
            shatter();
            shatterSound.play();
            //
            
        });

        function shatter() {
            var clickPosition = [randomRange(0, imageWidth), randomRange(0, imageHeight)];
            triangulate(clickPosition);
            shatterAnimation(clickPosition);
        }

        function triangulate(clickPosition) {
            var rings = [
                { r: 500, c: 12 },
                { r: 10, c: 12 },
                { r: 305, c: 12 },
                { r: 1200, c: 12 } // very large in case of corner clicks
            ];
            var x, y;
            var centerX = clickPosition[0];
            var centerY = clickPosition[1];

            vertices.push([centerY, centerX]);

            rings.forEach(function (ring) {
                var radius = ring.r;
                var count = ring.c;
                var variance = radius * 0.05;

                for (var i = 0; i < count; i++) {
                    x = Math.cos((i / count) * TWO_PI) * radius + centerY + randomRange(-variance, variance);
                    y = Math.sin((i / count) * TWO_PI) * radius + centerX + randomRange(-variance, variance);
                    vertices.push([x, y]);
                }
            });

            vertices.forEach(function (v) {
                v[0] = clamp(v[0], 0, imageWidth);
                v[1] = clamp(v[1], 0, imageHeight);
            });

            indices = Delaunay.triangulate(vertices);
        }

        function shatterAnimation(clickPosition) {
            var p0, p1, p2, fragment;
            var tl0 = new TimelineMax({ onComplete: shatterCompleteHandler });

            for (var i = 0; i < indices.length; i += 3) {
                p0 = vertices[indices[i + 0]];
                p1 = vertices[indices[i + 1]];
                p2 = vertices[indices[i + 2]];

                fragment = new Fragment(p0, p1, p2);

                var dx = fragment.centroid[0] - clickPosition[1] / 2;
                var dy = fragment.centroid[1] - clickPosition[1] / 2;
                var d = Math.sqrt(dx * dx + dy * dy);
                var rx = 200 * sign(dy);
                var ry = 100 * -sign(dx);
                var delay = d * 0.004 * randomRange(0.9, 1.1);
                fragment.canvas.style.zIndex = Math.floor(d).toString();

                var tl1 = new TimelineMax();

                tl1.to(fragment.canvas, 1, {
                    z: -500,
                    rotationX: rx,
                    rotationY: ry,
                    ease: Cubic.easeIn
                });
                tl1.to(fragment.canvas, 0.4, { alpha: 0 }, 0.5);

                tl0.insert(tl1, delay);

                fragments.push(fragment);
                container.appendChild(fragment.canvas);
            }

            container.removeChild(images[imageIndex]);
            
        }

        function shatterCompleteHandler() {
            setTimeout(function () {
                fragments.forEach(function (f) {
                    container.removeChild(f.canvas);
                });
                fragments.length = 0;
                vertices.length = 0;
                indices.length = 0;

                placeImage();
            }, 10000);
        }

        function randomRange(min, max) {
            return min + (max - min) * Math.random();
        }

        function clamp(x, min, max) {
            return x < min ? min : (x > max ? max : x);
        }

        function sign(x) {
            return x < 0 ? -1 : 1;
        }

        function Fragment(v0, v1, v2) {
            this.v0 = v0;
            this.v1 = v1;
            this.v2 = v2;

            this.computeBoundingBox();
            this.computeCentroid();
            this.createCanvas();
            this.clip();
        }

        Fragment.prototype = {
            computeBoundingBox: function () {
                var xMin = Math.min(this.v0[0], this.v1[0], this.v2[0]);
                var xMax = Math.max(this.v0[0], this.v1[0], this.v2[0]);
                var yMin = Math.min(this.v0[1], this.v1[1], this.v2[1]);
                var yMax = Math.max(this.v0[1], this.v1[1], this.v2[1]);

                this.box = {
                    x: xMin,
                    y: yMin,
                    w: xMax - xMin,
                    h: yMax - yMin
                };
            },
            computeCentroid: function () {
                var x = (this.v0[0] + this.v1[0] + this.v2[0]) / 3;
                var y = (this.v0[1] + this.v1[1] + this.v2[1]) / 3;

                this.centroid = [x, y];
            },
            createCanvas: function () {
    this.canvas = document.createElement('canvas');
    this.canvas.width = this.box.w;
    this.canvas.height = this.box.h;
    this.canvas.style.width = this.box.w + 'px';
    this.canvas.style.height = this.box.h + 'px';
    this.canvas.style.left = this.box.x + 'px'; // Set left to the original x coordinate
    this.canvas.style.top = this.box.y + 'px'; // Set top to the original y coordinate
    this.ctx = this.canvas.getContext('2d');
},

            clip: function () {
                this.ctx.translate(-this.box.x, -this.box.y);
                this.ctx.beginPath();
                this.ctx.moveTo(this.v0[0], this.v0[1]);
                this.ctx.lineTo(this.v1[0], this.v1[1]);
                this.ctx.lineTo(this.v2[0], this.v2[1]);
                this.ctx.closePath();
                this.ctx.clip();
                this.ctx.drawImage(images[imageIndex], 0, 0);
            }
        };
    </script>
</body>
</html>
