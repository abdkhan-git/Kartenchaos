<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   
</head>
<style>
    body {
        background-color: #000;
        margin: 0;
        overflow: hidden;
    }

    canvas {
        position: absolute;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        -moz-backface-visibility: hidden;
        -ms-backface-visibility: hidden;
    }

    img {
       
        cursor: pointer;
    }

    .TEST {
        position: absolute;
        width: 240px;
        height: 366px;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        margin: auto;
    }
</style>
<body style="background-color: brown;">
    

    
    <!-- CLASH 1v1 PAGE -->
<div id="clash-page" >

    <!-- health-bars -->
    
    <div class="barcontainer" >
            
        <div class="bar1">
            <progress value="100" max="100" id="p1-health-bar">Player 1 Health</progress>
            
            <div class="p1-damage-indicator-container"><h1 class="p1-damage-taken hidden">-10</h1></p></div>

        </div>
        
        <div class="bar2">
            <progress value="100" max="100" id="p2-health-bar">Player 2 Health</progress>
        
            <div class="p2-damage-indicator-container"><h1 class="p2-damage-taken hidden">-10</h1></p></div>
        </div>
    </div>
    <div class = "cardcontainer">
    <div class = "card1container" id = "con" >
        <div class = "TEST" id = "con1">
        <img src = "client/cards/10C.svg" class = "card2clash" id = "player1card">
    </div>
    </div>
    <div class="vs-container">
        <p class = "v">V</p>
        <p class="s">S</p>
    </div>
    <div class = "card2container">
    <div class = "TEST2" id = "con2">
        <?xml version="1.0" encoding="UTF-8" standalone="no"?>
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="card" face="2J" height="3.5in" preserveAspectRatio="none" viewBox="-120 -168 240 336" width="2.5in"><defs><symbol id="J22" preserveAspectRatio="none" viewBox="0 0 1300 2000"><path stroke="black" stroke-linecap="round" stroke-linejoin="round" stroke-width="6" fill="none" d="M317.05664,1294.416 100,1620l220,-60 40,240 140,-200 160,200 40,-200 180,180 60,-220 260,60 -236.67969,-304.3027M1241.1987,534.58948a75,75 0 0 1 -75,75 75,75 0 0 1 -75,-75 75,75 0 0 1 75,-75 75,75 0 0 1 75,75zM980.11493,234.09686a75,75 0 0 1 -75,75 75,75 0 0 1 -75,-75 75,75 0 0 1 75,-75 75,75 0 0 1 75,75zM190.29556,431.1412a75,75 0 0 1 -75,75 75,75 0 0 1 -74.999997,-75 75,75 0 0 1 74.999997,-75 75,75 0 0 1 75,75zM924.3457,650.27148c42.40088,-50.45397 91.5936,-93.35356 167.5059,-106.53906 -0.4037,-3.03138 -0.6215,-6.0846 -0.6524,-9.14258 0.03,-15.96068 5.1503,-31.4957 14.6172,-44.3457C1026.3517,437.47479 931.12146,446.83238 840,440 761.98041,388.07638 804.10248,338.17898 853.51758,288.4043 842.40414,277.84182 834.79487,264.12701 831.71484,249.10742 687.94378,262.65874 542.4812,256.33752 420,520 369.08062,331.38331 278.61481,370.61289 187.77148,412.01367c1.66108,6.24042 2.50924,12.66925 2.52344,19.12695 -0.0209,17.1896 -5.94587,33.85038 -16.7832,47.19336 66.82714,55.25532 117.5686,127.8306 155.76953,213.91016M384.88867,1140c51.89013,98.343 153.91815,159.9189 265.11133,160 111.19809,-0.076 213.23257,-61.6527 265.125,-160M1095,1000A445,445 0 0 1 650,1445 445,445 0 0 1 205,1000 445,445 0 0 1 650,555 445,445 0 0 1 1095,1000Z"></path></symbol><symbol id="J21" preserveAspectRatio="none" viewBox="0 0 1300 2000"><path fill="black" d="M879.65521,937.6026a40,40 0 0 1 -40,40 40,40 0 0 1 -40,-40 40,40 0 0 1 40,-40 40,40 0 0 1 40,40zm-379.31039,0a40,40 0 0 1 -40,40 40,40 0 0 1 -40,-40 40,40 0 0 1 40,-40 40,40 0 0 1 40,40z"></path></symbol></defs><rect width="239" height="335" x="-119.5" y="-167.5" rx="12" ry="12" fill="white" stroke="black"></rect><use width="202.8" height="312" x="-101.4" y="-156" xlink:href="#J21"></use><use width="202.8" height="312" x="-101.4" y="-156" xlink:href="#J22"></use></svg>
        <audio id = "breaksound" src = "Glass Break Sound.mp3"></audio>
    </div>
    </div>
</div>
<button id="shatterButton">Shatter</button>
<div class="p1-card">Player 1
    <button class="p1-attack">ATTACK</button>
</div>
<div class="p2-card">Player 2
    <button class="p2-attack">ATTACK</button>
</div>





        
</div>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/175711/delaunay.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.13.2/TweenMax.min.js"></script>
    <script>
        const TWO_PI = Math.PI * 2.5;
        const imageWidth = 240; // Assuming image width
        const imageHeight = 366; // Assuming image height
        const images = document.querySelectorAll('.TEST2 img');

        var imageIndex = 0;
        var vertices = [];
        var indices = [];
        var fragments = [];
        var container = document.getElementById('con2');

        document.getElementById('shatterButton').addEventListener('click', function () {
            var shatterSound = document.getElementById('breaksound');
            shatterSound.currentTime = .5;
            shatter();
            shatterSound.play();
            //
            
        });

        function shatter() {
            var clickPosition = [randomRange(0, imageWidth), randomRange(0, imageHeight)];
            triangulate(clickPosition);
            shatterAnimation(clickPosition);
        }

        function triangulate(clickPosition) {
            var rings = [
                { r: 500, c: 12 },
                { r: 10, c: 12 },
                { r: 305, c: 12 },
                { r: 1200, c: 12 } // very large in case of corner clicks
            ];
            var x, y;
            var centerX = clickPosition[0];
            var centerY = clickPosition[1];

            vertices.push([centerY, centerX]);

            rings.forEach(function (ring) {
                var radius = ring.r;
                var count = ring.c;
                var variance = radius * 0.05;

                for (var i = 0; i < count; i++) {
                    x = Math.cos((i / count) * TWO_PI) * radius + centerY + randomRange(-variance, variance);
                    y = Math.sin((i / count) * TWO_PI) * radius + centerX + randomRange(-variance, variance);
                    vertices.push([x, y]);
                }
            });

            vertices.forEach(function (v) {
                v[0] = clamp(v[0], 0, imageWidth);
                v[1] = clamp(v[1], 0, imageHeight);
            });

            indices = Delaunay.triangulate(vertices);
        }

        function shatterAnimation(clickPosition) {
            var p0, p1, p2, fragment;
            var tl0 = new TimelineMax({ onComplete: shatterCompleteHandler });

            for (var i = 0; i < indices.length; i += 3) {
                p0 = vertices[indices[i + 0]];
                p1 = vertices[indices[i + 1]];
                p2 = vertices[indices[i + 2]];

                fragment = new Fragment(p0, p1, p2);

                var dx = fragment.centroid[0] - clickPosition[1] / 2;
                var dy = fragment.centroid[1] - clickPosition[1] / 2;
                var d = Math.sqrt(dx * dx + dy * dy);
                var rx = 200 * sign(dy);
                var ry = 100 * -sign(dx);
                var delay = d * 0.004 * randomRange(0.9, 1.1);
                fragment.canvas.style.zIndex = Math.floor(d).toString();

                var tl1 = new TimelineMax();

                tl1.to(fragment.canvas, 1, {
                    z: -500,
                    rotationX: rx,
                    rotationY: ry,
                    ease: Cubic.easeIn
                });
                tl1.to(fragment.canvas, 0.4, { alpha: 0 }, 0.5);

                tl0.insert(tl1, delay);

                fragments.push(fragment);
                container.appendChild(fragment.canvas);
            }

            container.removeChild(images[imageIndex]);
            
        }

        function shatterCompleteHandler() {
            setTimeout(function () {
                fragments.forEach(function (f) {
                    container.removeChild(f.canvas);
                });
                fragments.length = 0;
                vertices.length = 0;
                indices.length = 0;

                placeImage();
            }, 10000);
        }

        function randomRange(min, max) {
            return min + (max - min) * Math.random();
        }

        function clamp(x, min, max) {
            return x < min ? min : (x > max ? max : x);
        }

        function sign(x) {
            return x < 0 ? -1 : 1;
        }

        function Fragment(v0, v1, v2) {
            this.v0 = v0;
            this.v1 = v1;
            this.v2 = v2;

            this.computeBoundingBox();
            this.computeCentroid();
            this.createCanvas();
            this.clip();
        }

        Fragment.prototype = {
            computeBoundingBox: function () {
                var xMin = Math.min(this.v0[0], this.v1[0], this.v2[0]);
                var xMax = Math.max(this.v0[0], this.v1[0], this.v2[0]);
                var yMin = Math.min(this.v0[1], this.v1[1], this.v2[1]);
                var yMax = Math.max(this.v0[1], this.v1[1], this.v2[1]);

                this.box = {
                    x: xMin,
                    y: yMin,
                    w: xMax - xMin,
                    h: yMax - yMin
                };
            },
            computeCentroid: function () {
                var x = (this.v0[0] + this.v1[0] + this.v2[0]) / 3;
                var y = (this.v0[1] + this.v1[1] + this.v2[1]) / 3;

                this.centroid = [x, y];
            },
            createCanvas: function () {
    this.canvas = document.createElement('canvas');
    this.canvas.width = this.box.w;
    this.canvas.height = this.box.h;
    this.canvas.style.width = this.box.w + 'px';
    this.canvas.style.height = this.box.h + 'px';
    this.canvas.style.left = this.box.x + 'px'; // Set left to the original x coordinate
    this.canvas.style.top = this.box.y + 'px'; // Set top to the original y coordinate
    this.ctx = this.canvas.getContext('2d');
},

            clip: function () {
                this.ctx.translate(-this.box.x, -this.box.y);
                this.ctx.beginPath();
                this.ctx.moveTo(this.v0[0], this.v0[1]);
                this.ctx.lineTo(this.v1[0], this.v1[1]);
                this.ctx.lineTo(this.v2[0], this.v2[1]);
                this.ctx.closePath();
                this.ctx.clip();
                this.ctx.drawImage(images[imageIndex], 0, 0);
            }
        };
    </script>
</body>
</html>
